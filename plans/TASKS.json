{
  "project": "Ralph CLI v1.2",
  "branchName": "ralph/v1.2-bug-fixes-memory",
  "description": "Bug fixes for streaming output and memory system improvements including CHANGELOG.md",
  "userStories": [
    {
      "id": "US-001",
      "title": "Fix stream-json requires verbose flag",
      "description": "As a developer, I want ralph once and ralph loop to work without the -v flag so that commands don't crash in normal usage",
      "acceptanceCriteria": [
        "When stream=True in run_print_mode(), --verbose is always included in CLI args",
        "ralph once works without any flags",
        "ralph loop works without any flags",
        "In non-verbose mode, stream-json is parsed but only text content is displayed",
        "In verbose mode, full JSON stream is displayed (current behavior preserved)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Critical bug - Issue #7. Fixed by adding conditional --verbose in run_print_mode() when streaming."
    },
    {
      "id": "US-002",
      "title": "Add newlines between message blocks in output",
      "description": "As a developer, I want proper newlines between response blocks so that output is readable without verbose mode",
      "acceptanceCriteria": [
        "_parse_stream_event() detects message boundaries in JSON stream",
        "Newline is added after each complete assistant message/turn",
        "Inline text flow is preserved within a single message",
        "Output is readable without requiring verbose mode",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Issue #6. Fixed by detecting content_block_stop, message_stop, and result events and returning MESSAGE_BOUNDARY newline. v1.2.1 added content_block_stop detection to properly handle newlines between content blocks within the same message."
    },
    {
      "id": "US-003",
      "title": "Enable skip permissions for ralph prd",
      "description": "As a developer, I want ralph prd to skip permission prompts so that PRD creation runs autonomously",
      "acceptanceCriteria": [
        "run_interactive() accepts skip_permissions: bool = False parameter",
        "When skip_permissions=True, --dangerously-skip-permissions is included in args",
        "ralph prd calls run_interactive() with skip_permissions=True",
        "Info message displayed about auto-approved permissions",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Issue #4. Added skip_permissions parameter to run_interactive() and ralph prd now uses it with skip_permissions=True."
    },
    {
      "id": "US-004",
      "title": "Create CHANGELOG.md on ralph init",
      "description": "As a developer, I want ralph init to create a CHANGELOG.md file so that I have persistent memory across feature cycles",
      "acceptanceCriteria": [
        "ralph init creates CHANGELOG.md in project root if it doesn't exist",
        "Template follows Keep a Changelog format",
        "Template includes Unreleased section with category headers",
        "Existing CHANGELOG.md is not overwritten",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Issue #9. Added create_changelog() to ScaffoldService with Keep a Changelog format and all category headers. Init command preserves existing CHANGELOG.md."
    },
    {
      "id": "US-005",
      "title": "Add CHANGELOG guidelines to CLAUDE.md and AGENTS.md",
      "description": "As a developer, I want CHANGELOG guidelines in project docs so that Claude knows when and how to update the changelog",
      "acceptanceCriteria": [
        "CLAUDE.md template includes CHANGELOG.md section with when/how to update",
        "AGENTS.md template includes same CHANGELOG.md section (kept in sync)",
        "Guidelines specify which changes warrant CHANGELOG entries",
        "Guidelines specify which changes should NOT be logged",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Issue #9. Added CHANGELOG.md section to both templates in scaffold.py with when/how/when-not guidelines."
    },
    {
      "id": "US-006",
      "title": "Update iteration prompt for CHANGELOG",
      "description": "As a developer, I want the iteration skill to mention CHANGELOG updates so that Claude remembers to document significant changes",
      "acceptanceCriteria": [
        "ralph-iteration/SKILL.md mentions updating CHANGELOG.md for significant changes",
        "Instructions are clear about what constitutes a significant change",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Issue #9. Added CHANGELOG.md section to ralph-iteration/SKILL.md with when/when-not/how guidelines and file reference table entry."
    },
    {
      "id": "US-007",
      "title": "Archive PROGRESS.txt on new task generation",
      "description": "As a developer, I want PROGRESS.txt archived when generating new tasks so that stale context doesn't confuse Claude",
      "acceptanceCriteria": [
        "After writing new TASKS.json, existing PROGRESS.txt is checked",
        "If PROGRESS.txt exists and is non-empty, it is archived to plans/PROGRESS.{timestamp}.txt",
        "Timestamp format is YYYYMMDD_HHMMSS",
        "Fresh PROGRESS.txt is created with header template",
        "Message displayed: Archived previous progress to PROGRESS.{timestamp}.txt",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Issue #8. Added _archive_progress_file() helper to tasks.py that archives existing PROGRESS.txt with YYYYMMDD_HHMMSS timestamp and creates fresh template."
    },
    {
      "id": "US-008",
      "title": "Enable streaming for ralph tasks",
      "description": "As a developer, I want ralph tasks to stream output so that I get feedback during generation",
      "acceptanceCriteria": [
        "ralph tasks uses stream=True in run_print_mode()",
        "Users see Claude's progress as it generates the task breakdown",
        "JSON extraction still works correctly from streamed output",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Issue #5. Changed stream=False to stream=True in tasks.py. Added TestTasksCommandStreaming test class with 4 tests verifying JSON extraction works with streamed output."
    },
    {
      "id": "US-009",
      "title": "Add unit tests for bug fixes",
      "description": "As a developer, I want unit tests for the bug fixes so that regressions are prevented",
      "acceptanceCriteria": [
        "Test _build_base_args() always includes --verbose when streaming",
        "Test _parse_stream_event() returns newline markers correctly",
        "Test run_interactive() with skip_permissions=True",
        "Test PROGRESS.txt archival with timestamp format",
        "All tests pass",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Added tests/test_bug_fixes.py with 31 comprehensive tests covering: streaming verbose behavior (6 tests), newline markers (8 tests), skip_permissions (6 tests), archival timestamp (9 tests), and integration (2 tests)."
    },
    {
      "id": "US-010",
      "title": "Add integration tests for commands",
      "description": "As a developer, I want integration tests for the fixed commands so that end-to-end behavior is verified",
      "acceptanceCriteria": [
        "Test ralph once runs without -v flag (no crash)",
        "Test ralph loop runs without -v flag (no crash)",
        "Test ralph tasks streams output",
        "Test ralph init creates CHANGELOG.md",
        "All tests pass",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Added tests/test_integration/test_command_integration.py with 19 integration tests: TestOnceCommandWithoutVerboseFlag (4), TestLoopCommandWithoutVerboseFlag (4), TestTasksCommandStreaming (3), TestInitCommandChangelogCreation (5), TestMessageBoundaryNewlines (1), TestSkipPermissionsIntegration (2). All 565 tests pass."
    }
  ]
}
