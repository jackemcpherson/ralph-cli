# Ralph Progress Log

## Codebase Patterns

(Add reusable patterns discovered during iterations here)

---

## Log

(Iteration entries will be appended below)

---

## 2026-01-22 - US-001

**Story:** Skip PRD prompt in non-interactive init mode

### What was implemented
- Added `skip_claude` parameter to `_handle_missing_prd` function in `src/ralph/commands/init_cmd.py`
- When `skip_claude=True`, the function skips the `Confirm.ask` prompt and prints a message instead
- Updated the call site in `init()` to pass `skip_claude=skip_claude` to `_handle_missing_prd`

### Tests written
- `test_init_skip_claude_skips_prd_prompt` - Integration test verifying --skip-claude completes without calling Confirm.ask and all files are created
- `test_handle_missing_prd_skips_prompt_when_skip_claude_true` - Unit test for the function with skip_claude=True
- `test_handle_missing_prd_prompts_when_skip_claude_false` - Unit test verifying prompt is shown when skip_claude=False
- `test_handle_missing_prd_prompts_by_default` - Unit test for backwards compatibility (prompts when parameter not specified)

### Files changed
- `src/ralph/commands/init_cmd.py` - Added skip_claude parameter and logic
- `tests/test_commands_integration.py` - Added 4 new tests

### Learnings for future iterations
- Using keyword-only arguments (with `*`) ensures the parameter must be passed explicitly, improving code clarity
- The existing test already mocked `Confirm.ask` which masked the blocking behavior; new test verifies the fix

---

[Ralph Loop] 2026-01-22 05:09 UTC - Iteration 1: US-001 (Skip PRD prompt in non-interactive init mode) completed

---

## 2026-01-22 - US-002

**Story:** Use file references in skill prompt construction

### What was implemented
- Added `get_path()` method to `SkillLoader` in `src/ralph/services/skill_loader.py` to return filesystem paths to bundled skill files
- Updated `build_skill_prompt()` in `src/ralph/utils/prompt.py` to use direct file references instead of copying to temp files
- Prompts now use `@{actual_skill_path}` notation pointing to the bundled SKILL.md files
- Removed temp file creation logic - no longer needed since bundled files have stable filesystem paths

### Tests updated
- `test_prompt_uses_file_reference` - Updated to check for SKILL.md in path
- `test_prompt_handles_nested_skill_names` - Updated to check for actual path format
- `test_once_prompt_uses_file_reference` - Updated to check for SKILL.md
- `TestCommandSkillPaths` tests - Updated to check for direct file references

### Documentation
- Added prompt construction pattern to CLAUDE.md Codebase Patterns section
- Added prompt construction pattern to AGENTS.md Codebase Patterns section

### Files changed
- `src/ralph/services/skill_loader.py` - Added `get_path()` and `_get_package_skill_path()` methods
- `src/ralph/utils/prompt.py` - Simplified to use direct file references
- `tests/test_commands_integration.py` - Updated tests for new path format
- `CLAUDE.md` - Documented prompt construction pattern
- `AGENTS.md` - Documented prompt construction pattern

### Learnings for future iterations
- `importlib.resources.files()` returns Traversables that can be converted to filesystem Paths for normal package installs
- Direct file references are simpler and more efficient than temp file copying

---

## 2026-01-22 - US-003

**Story:** Add rich formatting to review loop display

### What was implemented
- Added `print_review_step()` function to `src/ralph/utils/console.py` that displays `[Review X/Y] reviewer-name` with bold blue styling, matching the iteration loop style
- Refactored `_run_review_loop()` in `src/ralph/commands/loop.py` to iterate through reviewers directly and display progress before each one runs
- The review loop now shows progress counters like `[Review 1/4]` before each reviewer executes

### Tests written
- `test_review_loop_displays_progress_counters` - Integration test verifying progress counters are displayed for each reviewer
- `test_print_review_step_formats_correctly` - Unit test verifying the expected output format
- `test_print_review_step_matches_print_step_style` - Unit test verifying consistent styling with print_step()

### Files changed
- `src/ralph/utils/console.py` - Added `print_review_step()` function
- `src/ralph/utils/__init__.py` - Exported `print_review_step`
- `src/ralph/commands/loop.py` - Refactored `_run_review_loop()` to display progress counters
- `tests/test_commands_integration.py` - Added 3 new tests

### Learnings for future iterations
- Keep Rich console output in the command layer (loop.py) rather than the service layer for better separation of concerns
- When testing Rich output, use `no_color=True` and `force_terminal=False` to get plain text for assertions

---
