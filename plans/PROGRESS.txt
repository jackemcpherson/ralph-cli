# Ralph Progress Log

## Codebase Patterns

- Use Pydantic `alias` with `populate_by_name=True` when JSON uses camelCase but Python should use snake_case
- Use `by_alias=True` in `model_dump_json()` to serialize back to the original JSON format
- Import `Iterator`, `Sequence`, etc. from `collections.abc` instead of `typing` (ruff UP035)

---

## Log

(Iteration entries will be appended below)

---

## 2026-01-17 - US-004

**Story:** Create Rich console utilities

### What was implemented
- Created `src/ralph/utils/console.py` with Rich-based console helpers
- Added shared `Console` instance for consistent output across the application
- Implemented `print_success()` with green checkmark for success messages
- Implemented `print_error()` with red X for error messages
- Implemented `print_warning()` with yellow warning sign for warning messages
- Implemented `print_step()` for iteration progress display (e.g., `[1/5] Processing...`)
- Implemented `create_spinner()` context manager using Rich's status spinner
- Updated `utils/__init__.py` to export all public symbols

### Files changed
- src/ralph/utils/console.py (new)
- src/ralph/utils/__init__.py (modified)

### Learnings for future iterations
- Import `Iterator` from `collections.abc` instead of `typing` to satisfy ruff UP035 rule
- Rich's `console.status()` provides an easy way to create spinners with context manager syntax

---

## 2026-01-17 - US-003

**Story:** Create configuration models and quality check parser

### What was implemented
- Created `src/ralph/models/config.py` with QualityCheck and QualityChecks Pydantic models
- QualityCheck model includes: name, command, required (with default=True)
- QualityChecks model contains a list of QualityCheck items
- Implemented `parse_quality_checks()` to extract YAML between RALPH:CHECKS:START and RALPH:CHECKS:END markers using regex
- Implemented `load_quality_checks()` helper to load directly from a file path
- Parser returns empty QualityChecks on missing markers or malformed YAML (graceful degradation)
- Added pyyaml>=6.0.0 dependency to pyproject.toml
- Updated `models/__init__.py` to export all new public symbols

### Files changed
- src/ralph/models/config.py (new)
- src/ralph/models/__init__.py (modified)
- pyproject.toml (modified)
- uv.lock (modified)

### Learnings for future iterations
- Use `yaml.safe_load()` for security when parsing untrusted YAML content
- Regex with `re.DOTALL` flag is useful for matching across multiple lines
- Return empty container models instead of None for graceful handling of missing/malformed data

---

## 2026-01-17 - US-002

**Story:** Create Pydantic models for TASKS.json

### What was implemented
- Created `src/ralph/models/tasks.py` with UserStory and TasksFile Pydantic models
- UserStory model includes: id, title, description, acceptance_criteria, priority, passes, notes
- TasksFile model includes: project, branch_name, description, user_stories
- Used Pydantic aliases to maintain camelCase JSON compatibility (e.g., `acceptanceCriteria` in JSON maps to `acceptance_criteria` in Python)
- Implemented `load_tasks()` function to read and validate TASKS.json files
- Implemented `save_tasks()` function to serialize models back to JSON with proper camelCase
- Updated `models/__init__.py` to export all public symbols

### Files changed
- src/ralph/models/tasks.py (new)
- src/ralph/models/__init__.py (modified)

### Learnings for future iterations
- Ruff lint rule N815 flags mixedCase variables; use Pydantic aliases to satisfy both Python conventions and external JSON schemas
- `ConfigDict(populate_by_name=True)` allows models to accept both alias (camelCase) and field name (snake_case)
- Remember to use `by_alias=True` when serializing to preserve original JSON format

---

## 2026-01-17 - US-001

**Story:** Initialize project structure with pyproject.toml

### What was implemented
- Created pyproject.toml with all required dependencies (typer, rich, pydantic, ruff, pytest, pytest-cov, pyright)
- Configured hatchling build backend with src layout
- Set up Python 3.11+ requirement
- Created src/ralph/ directory structure with __init__.py files
- Created empty module directories: commands/, models/, services/, utils/
- Created basic cli.py with Typer app entry point
- Added README.md with basic documentation
- Added .gitignore for Python projects
- Added initial test for version verification
- Verified package installs successfully with `uv pip install -e ".[dev]"`

### Files changed
- pyproject.toml (new)
- README.md (new)
- .gitignore (new)
- src/ralph/__init__.py (new)
- src/ralph/cli.py (new)
- src/ralph/commands/__init__.py (new)
- src/ralph/models/__init__.py (new)
- src/ralph/services/__init__.py (new)
- src/ralph/utils/__init__.py (new)
- tests/__init__.py (new)
- tests/test_init.py (new)

### Learnings for future iterations
- pytest returns exit code 5 when no tests are collected, so at least one test file is needed
- hatchling requires README.md to exist if referenced in pyproject.toml
- uv requires a virtual environment to be created first with `uv venv`

---
