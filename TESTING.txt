# Ralph CLI Testing Notes

## Test: Building Pomodoro Timer CLI

### Date: 2026-01-17

---

## Issue #1: `ralph prd` requires interactive terminal input

**Description:** The `ralph prd` command launches an interactive Claude session that expects user input via stdin. When called from another process or script, the session ends immediately without generating a proper PRD because there's no way to provide interactive input.

**Impact:** Users cannot automate PRD generation or use `ralph prd` in CI/CD pipelines or from other tools.

**Workaround:** Manually create/edit the SPEC.md file, or use the command from a true interactive terminal.

**Possible Enhancement:** Consider supporting a `--input` flag or piped input for automated use cases, e.g.:
- `ralph prd --input "A pomodoro timer CLI with Rich output"`
- `echo "description" | ralph prd`

**Note:** This is expected behavior for an interactive PRD tool. Users who don't want to use the interactive session can manually edit `plans/SPEC.md` directly.

---

## Issue #2: `ralph prd` reports success even when PRD wasn't updated

**Description:** When `ralph prd` is run with piped input that gets exhausted before the interactive session completes, the command still reports "PRD saved to plans/SPEC.md" even though the file wasn't actually modified.

**Expected:** Should check if the file was modified and report accurately.

**Workaround:** Check the file modification time or contents manually.

---

## Issue #3: Claude still asks for permissions despite `--dangerously-skip-permissions`

**Description:** When `ralph loop` or `ralph once` invokes Claude via subprocess with `--dangerously-skip-permissions`, the CLI permission system is bypassed but Claude (the AI) still verbally asks for file write permissions in its response.

**Error Output:**
```
I need file write permissions to proceed with the project setup. Please grant write permissions so I can create the necessary project files (pyproject.toml, src/pomodoro/*.py, tests/*.py).
```

**Impact:** The autonomous iteration loop cannot function because Claude asks for permission in its response instead of executing.

**Analysis:**
- The code at `src/ralph/commands/loop.py:153` and `src/ralph/commands/once.py:292` correctly passes `skip_permissions=True`
- This adds `--dangerously-skip-permissions` to the Claude CLI command
- The CLI permission prompts are bypassed, but Claude itself still asks for permission conversationally
- This appears to be Claude being cautious about writing files even when the permission system allows it

**Status:** Bug persists. Investigating further.

**Possible Fixes:**
1. Add explicit instructions in the iteration prompt telling Claude it has full write permission
2. Modify the system prompt to indicate autonomous mode with pre-approved permissions
3. Check if there's a specific Claude Code flag or setting for fully autonomous operation

---

## Testing Progress

- [x] `ralph init` - Works correctly, scaffolds project files
- [x] `ralph prd` - Requires interactive input (see Issue #1 & #2), works from real terminal
- [x] `ralph tasks` - Works correctly, generated 10 user stories from spec
- [ ] `ralph once` - TBD
- [ ] `ralph loop` - Testing now...
- [ ] `ralph sync` - TBD
