# Ralph Progress Log

## Codebase Patterns

- Use Pydantic `alias` with `populate_by_name=True` when JSON uses camelCase but Python should use snake_case
- Use `by_alias=True` in `model_dump_json()` to serialize back to the original JSON format
- Import `Iterator`, `Sequence`, etc. from `collections.abc` instead of `typing` (ruff UP035)
- Use Pydantic `BaseModel` for all classes, NOT stdlib `@dataclass` - this is a Pydantic project
- Use `ConfigDict(arbitrary_types_allowed=True)` when fields use types like `Path` or `TextIO`
- Use `X | None` instead of `Optional[X]` for type annotations (ruff UP045)

---

## Log

(Iteration entries will be appended below)

---

## 2026-01-17 - US-010

**Story:** Set up Typer CLI app with help and version

### What was implemented
- Updated `src/ralph/cli.py` with --version/-V flag using version_callback
- Created command stub modules in `src/ralph/commands/`:
  - `init_cmd.py` - Scaffold project for Ralph workflow (stub)
  - `prd.py` - Interactive PRD creation with Claude (stub)
  - `tasks.py` - Convert spec to TASKS.json (stub)
  - `once.py` - Execute single iteration (stub)
  - `loop.py` - Run multiple iterations (stub)
  - `sync.py` - Sync skills to ~/.claude/skills/ (stub)
- Updated `commands/__init__.py` to export all command functions
- Registered all commands in main CLI app with descriptive help text
- Commands currently display "not yet implemented" warning until later stories

### Files changed
- src/ralph/cli.py (modified)
- src/ralph/commands/__init__.py (modified)
- src/ralph/commands/init_cmd.py (new)
- src/ralph/commands/prd.py (new)
- src/ralph/commands/tasks.py (new)
- src/ralph/commands/once.py (new)
- src/ralph/commands/loop.py (new)
- src/ralph/commands/sync.py (new)

### Learnings for future iterations
- Use `bool | None` instead of `Optional[bool]` to satisfy ruff UP045 rule
- Named init command file `init_cmd.py` to avoid conflict with Python's `init` module
- Command stubs use `typer.Exit(1)` to signal incomplete implementation

---

## 2026-01-17 - US-009

**Story:** Create skills sync service

### What was implemented
- Created `src/ralph/services/skills.py` with SkillsService class using Pydantic BaseModel
- Created `SyncStatus` enum for sync operation results (CREATED, UPDATED, SKIPPED, INVALID)
- Created `SkillInfo` model for skill metadata (name, description, path)
- Created `SkillSyncResult` model for sync operation results
- `list_local_skills()` - Finds skill directories containing SKILL.md in skills/ folder
- `validate_skill(path)` - Validates SKILL.md has required frontmatter (name, description)
- `sync_skill(skill_path)` - Copies skill to ~/.claude/skills/, returns status
- `sync_all()` - Syncs all valid skills, returns list of results
- `_parse_frontmatter()` - Simple YAML frontmatter parser without external dependency
- Updated `services/__init__.py` to export SkillsService, SkillInfo, SkillSyncResult, SyncStatus

### Files changed
- src/ralph/services/skills.py (new)
- src/ralph/services/__init__.py (modified)

### Learnings for future iterations
- Skills use SKILL.md with YAML frontmatter containing `name` and `description` fields
- Simple frontmatter parsing with regex avoids needing yaml dependency for this module
- Use shutil.copytree/rmtree for directory operations when syncing skills

---

## 2026-01-17 - US-008

**Story:** Create project scaffolding service

### What was implemented
- Created `src/ralph/services/scaffold.py` with ScaffoldService class using Pydantic BaseModel
- Created `ProjectType` enum for detected project types (Python, Node.js, Go, Rust, Unknown)
- `detect_project_type()` - Identifies project by marker files (pyproject.toml, package.json, go.mod, Cargo.toml)
- `create_plans_directory()` - Creates plans/ folder structure
- `create_spec_placeholder()` - Creates plans/SPEC.md with template
- `create_tasks_placeholder()` - Creates plans/TASKS.json with example structure
- `create_progress_placeholder()` - Creates plans/PROGRESS.txt with template
- `create_claude_md()` - Creates CLAUDE.md with project-specific quality checks template
- `create_agents_md()` - Creates AGENTS.md with Ralph workflow instructions
- `scaffold_all()` - Convenience method to create all files at once
- `_get_quality_checks_yaml()` - Returns appropriate quality checks YAML for detected project type
- Updated `services/__init__.py` to export ScaffoldService and ProjectType

### Files changed
- src/ralph/services/scaffold.py (new)
- src/ralph/services/__init__.py (modified)

### Learnings for future iterations
- Use Enum for type-safe project type detection
- Quality check templates should be project-type-specific for better developer experience
- Include Rust support alongside Python/Node.js/Go for broader coverage

---

## 2026-01-17 - US-007

**Story:** Create Claude Code CLI wrapper service

### What was implemented
- Created `src/ralph/services/claude.py` with ClaudeService dataclass
- `run_interactive(prompt)` - Launches Claude Code interactively with optional initial prompt
- `run_print_mode(prompt)` - Executes with -p flag, supports streaming output to terminal
- `run_with_output_format(prompt, format)` - Runs with specific output format (text/json/stream-json)
- All methods support: --verbose flag, model selection, max_turns, system_prompt, allowed_tools
- `_stream_output()` helper streams stdout line-by-line to terminal in real-time
- `_build_base_args()` constructs base CLI arguments
- Created `ClaudeError` exception class for operation failures
- Updated `services/__init__.py` to export ClaudeService and ClaudeError

### Files changed
- src/ralph/services/claude.py (new)
- src/ralph/services/__init__.py (modified)

### Learnings for future iterations
- Use `subprocess.Popen` with `stdout=PIPE` for streaming line-by-line output
- Use configurable `stdout`/`stderr` TextIO fields for testability (can inject StringIO in tests)
- Break long error messages across multiple lines to satisfy ruff E501 (max 100 chars)

---

## 2026-01-17 - US-006

**Story:** Create Git service for branch management

### What was implemented
- Created `src/ralph/services/git.py` with GitService dataclass
- `get_current_branch()` - Returns current branch name using `git branch --show-current`
- `get_default_branch()` - Detects main/master by checking local branches and remote HEAD
- `branch_exists(name)` - Checks if a branch exists locally
- `checkout_or_create_branch(name, base)` - Switches to branch, creates from base if needed
- `commit(message, add_all)` - Creates commit, optionally staging all changes first
- `has_changes()` - Checks for uncommitted changes via `git status --porcelain`
- `stage_files(files)` - Stages specific files for commit
- Created `GitError` exception class for operation failures
- Updated `services/__init__.py` to export GitService and GitError

### Files changed
- src/ralph/services/git.py (new)
- src/ralph/services/__init__.py (modified)

### Learnings for future iterations
- Use `@dataclass` for service classes that need configuration (like working_dir)
- `subprocess.run()` with `text=True` returns string output instead of bytes
- Check both local branches and remote HEAD when detecting default branch

---

## 2026-01-17 - US-005

**Story:** Create file operation utilities

### What was implemented
- Created `src/ralph/utils/files.py` with file operation utilities
- `ensure_dir(path)` - Creates directory and parents if they don't exist
- `read_file(path, encoding)` - Reads file contents with configurable encoding
- `write_file(path, content, encoding)` - Writes content to file, creates parent dirs
- `append_file(path, content, encoding)` - Appends content, creates file if needed
- `file_exists(path)` - Checks if path exists and is a file
- `get_project_root()` - Walks up directory tree looking for project markers (pyproject.toml, package.json, go.mod, Cargo.toml, CLAUDE.md, .git)
- Updated `utils/__init__.py` to export all new functions

### Files changed
- src/ralph/utils/files.py (new)
- src/ralph/utils/__init__.py (modified)

### Learnings for future iterations
- Using `pathlib.Path` provides clean, cross-platform file operations
- `Path.mkdir(parents=True, exist_ok=True)` is equivalent to `mkdir -p`
- Always create parent directories when writing files to prevent errors

---

## 2026-01-17 - US-004

**Story:** Create Rich console utilities

### What was implemented
- Created `src/ralph/utils/console.py` with Rich-based console helpers
- Added shared `Console` instance for consistent output across the application
- Implemented `print_success()` with green checkmark for success messages
- Implemented `print_error()` with red X for error messages
- Implemented `print_warning()` with yellow warning sign for warning messages
- Implemented `print_step()` for iteration progress display (e.g., `[1/5] Processing...`)
- Implemented `create_spinner()` context manager using Rich's status spinner
- Updated `utils/__init__.py` to export all public symbols

### Files changed
- src/ralph/utils/console.py (new)
- src/ralph/utils/__init__.py (modified)

### Learnings for future iterations
- Import `Iterator` from `collections.abc` instead of `typing` to satisfy ruff UP035 rule
- Rich's `console.status()` provides an easy way to create spinners with context manager syntax

---

## 2026-01-17 - US-003

**Story:** Create configuration models and quality check parser

### What was implemented
- Created `src/ralph/models/config.py` with QualityCheck and QualityChecks Pydantic models
- QualityCheck model includes: name, command, required (with default=True)
- QualityChecks model contains a list of QualityCheck items
- Implemented `parse_quality_checks()` to extract YAML between RALPH:CHECKS:START and RALPH:CHECKS:END markers using regex
- Implemented `load_quality_checks()` helper to load directly from a file path
- Parser returns empty QualityChecks on missing markers or malformed YAML (graceful degradation)
- Added pyyaml>=6.0.0 dependency to pyproject.toml
- Updated `models/__init__.py` to export all new public symbols

### Files changed
- src/ralph/models/config.py (new)
- src/ralph/models/__init__.py (modified)
- pyproject.toml (modified)
- uv.lock (modified)

### Learnings for future iterations
- Use `yaml.safe_load()` for security when parsing untrusted YAML content
- Regex with `re.DOTALL` flag is useful for matching across multiple lines
- Return empty container models instead of None for graceful handling of missing/malformed data

---

## 2026-01-17 - US-002

**Story:** Create Pydantic models for TASKS.json

### What was implemented
- Created `src/ralph/models/tasks.py` with UserStory and TasksFile Pydantic models
- UserStory model includes: id, title, description, acceptance_criteria, priority, passes, notes
- TasksFile model includes: project, branch_name, description, user_stories
- Used Pydantic aliases to maintain camelCase JSON compatibility (e.g., `acceptanceCriteria` in JSON maps to `acceptance_criteria` in Python)
- Implemented `load_tasks()` function to read and validate TASKS.json files
- Implemented `save_tasks()` function to serialize models back to JSON with proper camelCase
- Updated `models/__init__.py` to export all public symbols

### Files changed
- src/ralph/models/tasks.py (new)
- src/ralph/models/__init__.py (modified)

### Learnings for future iterations
- Ruff lint rule N815 flags mixedCase variables; use Pydantic aliases to satisfy both Python conventions and external JSON schemas
- `ConfigDict(populate_by_name=True)` allows models to accept both alias (camelCase) and field name (snake_case)
- Remember to use `by_alias=True` when serializing to preserve original JSON format

---

## 2026-01-17 - US-001

**Story:** Initialize project structure with pyproject.toml

### What was implemented
- Created pyproject.toml with all required dependencies (typer, rich, pydantic, ruff, pytest, pytest-cov, pyright)
- Configured hatchling build backend with src layout
- Set up Python 3.11+ requirement
- Created src/ralph/ directory structure with __init__.py files
- Created empty module directories: commands/, models/, services/, utils/
- Created basic cli.py with Typer app entry point
- Added README.md with basic documentation
- Added .gitignore for Python projects
- Added initial test for version verification
- Verified package installs successfully with `uv pip install -e ".[dev]"`

### Files changed
- pyproject.toml (new)
- README.md (new)
- .gitignore (new)
- src/ralph/__init__.py (new)
- src/ralph/cli.py (new)
- src/ralph/commands/__init__.py (new)
- src/ralph/models/__init__.py (new)
- src/ralph/services/__init__.py (new)
- src/ralph/utils/__init__.py (new)
- tests/__init__.py (new)
- tests/test_init.py (new)

### Learnings for future iterations
- pytest returns exit code 5 when no tests are collected, so at least one test file is needed
- hatchling requires README.md to exist if referenced in pyproject.toml
- uv requires a virtual environment to be created first with `uv venv`

---

## 2026-01-17 - US-011

**Story:** Implement ralph init command

### What was implemented
- Implemented full `ralph init` command in `src/ralph/commands/init_cmd.py`
- Uses `ScaffoldService` to create all Ralph workflow files
- Detects project type (Python, Node.js, Go, Rust) and sets appropriate quality checks
- Added `--force` flag to overwrite existing files
- Added `--skip-claude` flag to skip Claude Code /init invocation
- Added `--name` flag to customize project name
- Checks for existing Ralph files and warns before overwriting
- Invokes Claude Code `/init` to enhance CLAUDE.md and AGENTS.md
- Displays success message with next steps after initialization
- Added `_check_existing_files()` helper function

### Tests written
- `tests/test_commands/test_init_cmd.py` with 13 tests:
  - `test_init_creates_ralph_files` - verifies all files are created
  - `test_init_detects_python_project` - verifies Python detection
  - `test_init_detects_nodejs_project` - verifies Node.js detection
  - `test_init_refuses_overwrite_without_force` - verifies protection
  - `test_init_with_force_overwrites_files` - verifies --force flag
  - `test_init_with_skip_claude` - verifies --skip-claude flag
  - `test_init_with_custom_project_name` - verifies --name flag
  - `test_init_shows_next_steps` - verifies output messages
  - `test_init_handles_claude_error_gracefully` - verifies error handling
  - Tests for `_check_existing_files` helper function

### Files changed
- src/ralph/commands/init_cmd.py (modified)
- tests/test_commands/__init__.py (new)
- tests/test_commands/test_init_cmd.py (new)

### Learnings for future iterations
- Use `typer.testing.CliRunner` for testing CLI commands
- Change working directory with `os.chdir()` in tests, but always restore with `try/finally`
- Mock `ClaudeService` to avoid actually calling Claude during tests
- Use `Path.relative_to()` to display clean paths in output

---

## 2026-01-17 - US-012

**Story:** Implement ralph prd command

### What was implemented
- Implemented full `ralph prd` command in `src/ralph/commands/prd.py`
- Displays informational message before launching Claude (tips for good PRD session)
- Launches Claude Code in interactive mode with a structured PRD prompt
- Prompt includes PRD structure guidance: Overview, Goals, Non-Goals, Requirements, Technical Considerations, Success Criteria
- Added `--output` flag to customize output path (default: plans/SPEC.md)
- Added `--verbose` flag for verbose Claude output
- Checks for plans/ directory existence before launching
- Notes when SPEC.md already exists (update vs create)
- Shows success message with next steps when PRD is created
- Handles errors gracefully (non-zero exit, ClaudeError)

### Tests written
- `tests/test_commands/test_prd.py` with 15 tests:
  - `test_prd_requires_plans_directory` - verifies plans/ check
  - `test_prd_displays_informational_message` - verifies tips display
  - `test_prd_launches_claude_interactively` - verifies ClaudeService usage
  - `test_prd_includes_prd_prompt` - verifies prompt structure
  - `test_prd_shows_output_path` - verifies output path display
  - `test_prd_success_with_file_created` - verifies success handling
  - `test_prd_warning_when_file_not_created` - verifies cancelled session handling
  - `test_prd_handles_nonzero_exit_code` - verifies exit code handling
  - `test_prd_handles_claude_error` - verifies ClaudeError handling
  - `test_prd_notes_existing_spec` - verifies existing file note
  - `test_prd_with_custom_output_path` - verifies --output flag
  - `test_prd_with_verbose_flag` - verifies --verbose flag
  - Tests for `_build_prd_prompt` helper function

### Files changed
- src/ralph/commands/prd.py (modified)
- tests/test_commands/test_prd.py (new)

### Learnings for future iterations
- Use `_build_prd_prompt()` helper to keep prompt construction testable
- Check for prerequisite directories (like plans/) before launching interactive sessions
- Display helpful tips before launching interactive Claude sessions to improve UX

---

## 2026-01-17 - US-013

**Story:** Implement ralph tasks command

### What was implemented
- Implemented full `ralph tasks` command in `src/ralph/commands/tasks.py`
- Accepts spec file path argument (with typer validation for existence/readability)
- Invokes Claude Code in print mode (non-streaming) to generate TASKS.json
- Builds comprehensive prompt with JSON schema and story-creation guidelines
- Added `_extract_json()` helper to extract JSON from various formats:
  - Pure JSON
  - JSON wrapped in markdown code blocks (```json)
  - JSON embedded in surrounding text
- Validates Claude output against TasksFile Pydantic model
- Saves validated output to plans/TASKS.json (or custom path with --output)
- Added `--output` flag for custom output path
- Added `--verbose` flag for verbose Claude output
- Added `--branch` flag for custom branch name in generated tasks
- Displays success message with story count and next steps
- Handles errors gracefully: empty spec, Claude failures, invalid JSON, validation errors

### Tests written
- `tests/test_commands/test_tasks.py` with 35 tests:
  - `TestTasksCommand` class (17 tests):
    - `test_tasks_requires_spec_file_argument` - verifies argument required
    - `test_tasks_fails_for_nonexistent_file` - verifies file validation
    - `test_tasks_fails_for_empty_spec_file` - verifies empty file handling
    - `test_tasks_displays_informational_message` - verifies output
    - `test_tasks_launches_claude_in_print_mode` - verifies Claude invocation
    - `test_tasks_includes_spec_content_in_prompt` - verifies prompt building
    - `test_tasks_validates_claude_output` - verifies Pydantic validation
    - `test_tasks_saves_valid_output` - verifies file creation
    - `test_tasks_shows_success_message_with_story_count` - verifies success output
    - `test_tasks_handles_nonzero_exit_code` - verifies exit code handling
    - `test_tasks_handles_claude_error` - verifies ClaudeError handling
    - `test_tasks_notes_existing_tasks_json` - verifies existing file note
    - `test_tasks_with_custom_output_path` - verifies --output flag
    - `test_tasks_with_verbose_flag` - verifies --verbose flag
    - `test_tasks_with_branch_name_flag` - verifies --branch flag
    - `test_tasks_handles_no_json_in_output` - verifies no-JSON handling
  - `TestExtractJson` class (7 tests) for _extract_json helper
  - `TestIsValidJson` class (4 tests) for _is_valid_json helper
  - `TestBuildTasksPrompt` class (6 tests) for _build_tasks_prompt helper

### Files changed
- src/ralph/commands/tasks.py (modified - full implementation)
- tests/test_commands/test_tasks.py (new)

### Learnings for future iterations
- Use non-streaming mode (`stream=False`) when you need to capture and process Claude output
- Extract JSON robustly by trying multiple patterns: pure JSON, code blocks, embedded JSON
- Regex `[\s\S]*?` is useful for non-greedy matching across newlines in code blocks
- Pydantic `model_validate_json()` directly validates JSON strings without intermediate dict

---

## 2026-01-17 - US-014

**Story:** Implement ralph once command

### What was implemented
- Full `ralph once` command implementation in `src/ralph/commands/once.py`
- `ITERATION_PROMPT` constant with comprehensive iteration instructions for Claude
- `_find_next_story()` helper to find highest-priority incomplete story
- `_build_iteration_prompt()` helper to format story details into prompt
- `_append_cli_summary()` helper to append minimal CLI summary to PROGRESS.txt
- Load TASKS.json and validate structure using Pydantic models
- Exit with "All stories complete" when no incomplete stories remain
- Invoke Claude Code in print mode with streaming output
- Support `--verbose` flag for full JSON output
- Support `--max-fix-attempts` flag (default: 3) passed to iteration prompt
- Detect story completion by re-reading TASKS.json after Claude runs
- Display iteration summary with success/failure status
- Detect `<ralph>COMPLETE</ralph>` signal when all stories complete

### Tests written
- `tests/test_commands/test_once.py` with 19 tests:
  - `TestOnceCommand` class (12 tests):
    - `test_once_requires_tasks_json` - verifies TASKS.json requirement
    - `test_once_displays_story_info` - verifies story display
    - `test_once_picks_highest_priority_incomplete_story` - verifies priority logic
    - `test_once_exits_when_all_stories_complete` - verifies completion handling
    - `test_once_runs_claude_in_print_mode` - verifies Claude invocation
    - `test_once_handles_claude_error` - verifies error handling
    - `test_once_shows_remaining_count` - verifies progress display
    - `test_once_detects_all_complete_signal` - verifies COMPLETE detection
    - `test_once_with_verbose_flag` - verifies --verbose flag
    - `test_once_includes_max_fix_attempts_in_prompt` - verifies --max-fix-attempts
    - `test_once_detects_story_passed` - verifies success detection
    - `test_once_handles_invalid_tasks_json` - verifies error handling
  - `TestFindNextStory` class (3 tests) for _find_next_story helper
  - `TestBuildIterationPrompt` class (4 tests) for _build_iteration_prompt helper

### Files changed
- src/ralph/commands/once.py (modified - full implementation)
- tests/test_commands/test_once.py (new)

### Learnings for future iterations
- Use `datetime.UTC` instead of `timezone.utc` (ruff UP017)
- Initialize variables before try blocks to avoid "possibly unbound" pyright errors
- Use backslash continuation for long lines in multiline strings to satisfy ruff E501
- Re-read TASKS.json after Claude runs to detect if the story was marked as passed
- The `<ralph>COMPLETE</ralph>` signal indicates all stories are complete

---

## 2026-01-17 - US-015

**Story:** Implement ralph loop command

### What was implemented
- Full `ralph loop` command implementation in `src/ralph/commands/loop.py`
- `LoopStopReason` class with constants: ALL_COMPLETE, MAX_ITERATIONS, PERSISTENT_FAILURE, TRANSIENT_FAILURE, NO_TASKS, BRANCH_MISMATCH
- `_setup_branch()` helper to check/create feature branch from TASKS.json branchName
- `_find_next_story()` helper (reused pattern from once.py)
- `_build_iteration_prompt()` helper (reuses ITERATION_PROMPT from once.py)
- `_append_loop_progress()` helper for PROGRESS.txt updates
- Branch setup: checks current branch, warns about uncommitted changes, creates/switches as needed
- Iteration tracking: displays `[N/M] StoryID: Title` counter using print_step()
- Stop conditions: all complete, max iterations, persistent failure (same story fails 2x), transient failure (Claude error)
- Summary display: stories completed, total progress, remaining count, stop reason
- Supports `--verbose` and `--max-fix-attempts` flags

### Tests written
- `tests/test_commands/test_loop.py` with 27 tests:
  - `TestLoopCommand` class (15 tests): requires TASKS.json, displays project info, handles all complete, runs multiple iterations, stops on all complete signal, stops on max iterations, stops on persistent failure, handles Claude error, verbose flag, custom iterations, iteration counter, summary on completion, invalid TASKS.json, branch setup failure
  - `TestSetupBranch` class (6 tests): on correct branch, switches branch, creates new branch, warns uncommitted changes, handles git error, handles checkout error
  - `TestFindNextStory` class (3 tests): returns highest priority incomplete, returns None when all complete, handles unsorted priorities
  - `TestBuildIterationPrompt` class (3 tests): includes story details, acceptance criteria, max fix attempts
  - `TestLoopStopReason` class (1 test): stop reason constants exist

### Files changed
- src/ralph/commands/loop.py (modified - full implementation)
- tests/test_commands/test_loop.py (new)
- plans/TASKS.json (updated)

### Learnings for future iterations
- Reuse constants/prompts from related modules (ITERATION_PROMPT from once.py) to maintain consistency
- Use a dedicated class for stop reason constants to improve code clarity
- Branch switching should warn about uncommitted changes but still attempt the operation
- Persistent failure detection requires tracking consecutive failures on the same story ID
- The `_setup_branch` function is a good candidate for sharing between commands that need branch management

---

## 2026-01-17 - US-016

**Story:** Implement ralph sync command

### What was implemented
- Full `ralph sync` command implementation in `src/ralph/commands/sync.py`
- Uses SkillsService to list, validate, and sync skills from skills/ directory
- Displays source and target directories before syncing
- Shows status for each skill: created (green checkmark), updated, invalid (yellow warning), error (red X)
- Displays summary with counts: total synced, created, updated, invalid, errors
- Shows helpful message when skills/ directory doesn't exist or is empty
- Added `--skills-dir` / `-s` flag for custom skills directory
- Exits with code 1 if any skills fail to sync (SyncStatus.SKIPPED)

### Tests written
- `tests/test_commands/test_sync.py` with 11 tests:
  - `TestSyncCommand` class (10 tests):
    - `test_sync_shows_warning_when_no_skills_dir` - verifies missing skills/ handling
    - `test_sync_shows_warning_when_no_skills_found` - verifies empty skills/ handling
    - `test_sync_syncs_valid_skill` - verifies successful sync
    - `test_sync_shows_updated_status` - verifies updated status display
    - `test_sync_shows_invalid_skill_warning` - verifies invalid skill handling
    - `test_sync_with_custom_skills_dir` - verifies --skills-dir flag
    - `test_sync_fails_on_error` - verifies exit code on errors
    - `test_sync_displays_source_and_target` - verifies path display
    - `test_sync_multiple_skills` - verifies multiple skill handling
    - `test_sync_shows_no_skills_synced_when_all_invalid` - verifies all-invalid case
  - `TestSyncIntegration` class (1 test):
    - `test_sync_actually_copies_skill` - integration test verifying files are copied

### Files changed
- src/ralph/commands/sync.py (modified - full implementation)
- tests/test_commands/test_sync.py (new)

### Learnings for future iterations
- SkillsService already does the heavy lifting; command just orchestrates and displays
- Use Unicode checkmark/cross symbols for visual feedback in terminal
- Pydantic model fields can be customized at instantiation (target_dir) for testing
- Exit with non-zero code for errors but zero for warnings (invalid skills)

---

## 2026-01-17 - US-017

**Story:** Create ralph-prd skill definition

### What was implemented
- Created `skills/ralph-prd/SKILL.md` with required YAML frontmatter (name, description)
- Phase 1: Discovery questions covering project context, feature overview, scope definition, and technical considerations
- Phase 2: PRD generation with structured output format template
- Output format section with complete PRD markdown template for plans/SPEC.md
- Guidelines for feature scoping (right-size features, avoid scope creep, think in iterations)
- Guidelines for requirements quality (specific, testable, independent)
- Interaction style guidance (ask one category at a time, summarize understanding, be concise)
- Next steps prompt directing users to run `ralph tasks plans/SPEC.md`

### Tests written
- No Python tests needed for this story (skill is a markdown instruction file)
- Skill format validated by existing SkillsService tests (validates frontmatter parsing)

### Files changed
- skills/ralph-prd/SKILL.md (new)

### Learnings for future iterations
- Skills are markdown files with YAML frontmatter containing `name` and `description`
- Skills should guide Claude through a multi-phase process (discovery, then generation)
- Include concrete output format templates to ensure consistent results
- Always end skill instructions with next steps for the user

---

## 2026-01-17 - US-018

**Story:** Create ralph-tasks skill definition

### What was implemented
- Created `skills/ralph-tasks/SKILL.md` with required YAML frontmatter (name, description)
- Story sizing guidelines: right-sized stories (3-6 criteria, 5-7 files max), signs of too large/small stories
- Story breakdown patterns: foundational first, vertical slices for features
- Priority assignment guidance: 1-5 for models, 6-10 for services, 11-15 for commands, 16-20 for features, 21+ for tests
- Dependency rules: models before services, services before commands, core before extensions
- Acceptance criteria guidance: specific, testable, independent criteria with format examples
- Full TASKS.json output schema with field descriptions table
- Example transformation showing how to convert requirements to structured user stories
- Quality checks section for validating generated output
- Handling ambiguity guidance for unclear specifications

### Tests written
- No Python tests needed for this story (skill is a markdown instruction file)
- Skill format validated by existing SkillsService tests (validates frontmatter parsing)

### Files changed
- skills/ralph-tasks/SKILL.md (new)

### Learnings for future iterations
- Skills should provide concrete examples (like the example transformation) to guide Claude output
- Priority ranges help establish consistent ordering patterns across projects
- Include a quality checklist at the end for self-validation before output

---

## 2026-01-17 - US-019

**Story:** Create ralph-iteration skill definition

### What was implemented
- Created `skills/ralph-iteration/SKILL.md` with required YAML frontmatter (name, description)
- Structured skill into 4 phases: Context Gathering, Story Implementation, Quality Verification, Completion
- Phase 1 covers reading TASKS.json, PROGRESS.txt patterns, CLAUDE.md checks, and branch verification
- Phase 2 covers understanding story, planning approach, implementing, writing tests, self-review
- Phase 3 covers running quality checks, fix loop behavior (max 3 attempts), common issues table
- Phase 4 covers commit message format, TASKS.json updates, PROGRESS.txt appending, memory file updates
- Included detailed fix loop behavior with analyze/identify/fix/re-run cycle
- Documented commit message format: `feat: [Story ID] - [Story Title]`
- Added PROGRESS.txt format template with all required sections
- Included guidance on updating Codebase Patterns section for reusable discoveries
- Added CLAUDE.md/AGENTS.md update instructions (must stay in sync)
- Documented stop condition with `<ralph>COMPLETE</ralph>` signal
- Added error handling section for blocked/incomplete stories
- Included file reference table for quick lookup

### Tests written
- No Python tests needed for this story (skill is a markdown instruction file)
- Skill format validated by existing SkillsService tests (validates frontmatter parsing)

### Files changed
- skills/ralph-iteration/SKILL.md (new)

### Learnings for future iterations
- Skills should break complex workflows into clear phases for better agent understanding
- Include concrete examples (commit messages, JSON updates) rather than abstract descriptions
- Add error handling guidance so agents know what to do when blocked
- A file reference table at the end provides quick lookup during execution

---
