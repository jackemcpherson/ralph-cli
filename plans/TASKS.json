{
  "project": "ReviewLoop",
  "branchName": "ralph/review-loop",
  "description": "Add automated review loop to ralph loop command with configurable reviewer pipeline, language detection, and restructured skills directory",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create ReviewerConfig Pydantic model",
      "description": "As a developer, I want a Pydantic model for reviewer configuration so that reviewer settings can be validated and typed",
      "acceptanceCriteria": [
        "ReviewerConfig model with fields: name, skill, level, languages (optional)",
        "Level is an enum with values: blocking, warning, suggestion",
        "Languages field accepts list of strings or None",
        "Typecheck passes",
        "Unit tests for model validation"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Implemented in src/ralph/models/reviewer.py with 16 unit tests"
    },
    {
      "id": "US-002",
      "title": "Implement reviewer configuration parsing from CLAUDE.md",
      "description": "As a developer, I want to parse reviewer configuration from CLAUDE.md YAML blocks so that reviewers can be configured per-project",
      "acceptanceCriteria": [
        "Parse YAML between <!-- RALPH:REVIEWERS:START --> and <!-- RALPH:REVIEWERS:END --> markers",
        "Return list of ReviewerConfig objects",
        "Return default reviewers when markers not present",
        "Consistent pattern with existing checks parsing",
        "Typecheck passes",
        "Unit tests for parsing with and without markers"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Implemented in src/ralph/models/reviewer.py with 16 new tests for parsing functions"
    },
    {
      "id": "US-003",
      "title": "Implement language detection service",
      "description": "As a developer, I want to auto-detect project languages from marker files so that language-specific reviewers can be filtered appropriately",
      "acceptanceCriteria": [
        "Detect Python from pyproject.toml, setup.py, requirements.txt",
        "Detect JavaScript/TypeScript from package.json, tsconfig.json",
        "Detect Go from go.mod",
        "Detect Rust from Cargo.toml",
        "Return set of detected languages",
        "Support multiple languages detected simultaneously",
        "Typecheck passes",
        "Unit tests for each language detection"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Implemented in src/ralph/services/language.py with 28 unit tests"
    },
    {
      "id": "US-004",
      "title": "Add --skip-review and --strict flags to ralph loop",
      "description": "As a user, I want CLI flags to control review behavior so that I can skip reviews or enforce stricter checking",
      "acceptanceCriteria": [
        "--skip-review flag added to loop command",
        "--strict flag added to loop command",
        "Flags stored and passed to review loop execution",
        "Help text describes flag behavior",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Implemented flags in loop.py with 6 new tests for flag acceptance and help text"
    },
    {
      "id": "US-005",
      "title": "Implement review loop execution service",
      "description": "As a developer, I want a service that executes configured reviewers in order so that code quality is automatically checked after stories complete",
      "acceptanceCriteria": [
        "Execute reviewers in configured order",
        "Skip reviewers whose language filter doesn't match detected languages",
        "Spawn fresh Claude instance for each reviewer",
        "Retry up to 3 times for blocking reviewers on failure",
        "Continue to next reviewer after 3 failed attempts",
        "Append summary to PROGRESS.txt after each reviewer",
        "Handle blocking/warning/suggestion levels per behavior matrix",
        "Typecheck passes",
        "Unit tests for reviewer filtering and retry logic"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Implemented ReviewLoopService in src/ralph/services/review_loop.py with 27 unit tests covering filtering, retry logic, and progress logging"
    },
    {
      "id": "US-006",
      "title": "Integrate review loop into ralph loop command",
      "description": "As a user, I want ralph loop to automatically run the review loop after all stories pass so that code quality is assured",
      "acceptanceCriteria": [
        "Review loop runs after all stories pass (default behavior)",
        "Review loop skipped when --skip-review flag provided",
        "Warning reviewers enforced when --strict flag provided",
        "Console output shows review progress",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Integrated ReviewLoopService into loop.py with _run_review_loop function. Added 5 new tests for review loop integration."
    },
    {
      "id": "US-007",
      "title": "Restructure skills directory - ralph core skills",
      "description": "As a maintainer, I want ralph core skills moved to ralph/ subdirectory so that skills are logically organized",
      "acceptanceCriteria": [
        "Move ralph-prd/ to ralph/prd/",
        "Move ralph-tasks/ to ralph/tasks/",
        "Move ralph-iteration/ to ralph/iteration/",
        "SKILL.md files preserved in new locations",
        "Old directories removed"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Restructured skills/ralph-prd, ralph-tasks, ralph-iteration to skills/ralph/prd, tasks, iteration"
    },
    {
      "id": "US-008",
      "title": "Restructure skills directory - reviewer skills",
      "description": "As a maintainer, I want reviewer skills moved to reviewers/ subdirectory so that skills are logically organized",
      "acceptanceCriteria": [
        "Move code-simplifier/ to reviewers/code-simplifier/",
        "Move test-quality-reviewer/ to reviewers/test-quality/",
        "Move repo-structure-reviewer/ to reviewers/repo-structure/",
        "Move github-actions-reviewer/ to reviewers/github-actions/",
        "Move python-code-reviewer/ to reviewers/language/python/",
        "SKILL.md files preserved in new locations",
        "Old directories removed"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Restructured all reviewer skills to skills/reviewers/ with nested language/python/ for Python reviewer"
    },
    {
      "id": "US-009",
      "title": "Create release reviewer skill",
      "description": "As a user, I want a release reviewer skill so that release readiness is automatically checked",
      "acceptanceCriteria": [
        "Create reviewers/release/SKILL.md",
        "Check for changelog entries corresponding to changes",
        "Verify version consistency between pyproject.toml and __init__.py",
        "Verify documentation completeness (CHANGELOG.md, AGENTS.md, CLAUDE.md, README.md)",
        "Clean up PROGRESS.txt archives in plans/",
        "Verify git tag readiness (version not already tagged)",
        "Check for TODOs/FIXMEs that should be addressed"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Created skills/reviewers/release/SKILL.md with comprehensive release readiness checks"
    },
    {
      "id": "US-010",
      "title": "Update SkillLoader for nested paths",
      "description": "As a developer, I want SkillLoader to accept nested paths so that restructured skills can be loaded",
      "acceptanceCriteria": [
        "SkillLoader accepts paths like ralph/prd and reviewers/code-simplifier",
        "Skill content loaded correctly from nested directories",
        "Typecheck passes",
        "Unit tests for nested path loading"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Updated SkillLoader.load() docstring, added get_content() method, added 10 new tests for nested paths"
    },
    {
      "id": "US-011",
      "title": "Update command skill references to new paths",
      "description": "As a developer, I want all command skill references updated to use new nested paths so that commands work with restructured skills",
      "acceptanceCriteria": [
        "prd command uses ralph/prd skill path",
        "tasks command uses ralph/tasks skill path",
        "iteration commands use ralph/iteration skill path",
        "All commands function correctly with new paths",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Update ralph sync for nested structure",
      "description": "As a user, I want ralph sync to handle nested skill directories so that skills install correctly to ~/.claude/skills/",
      "acceptanceCriteria": [
        "Sync mirrors nested structure to ~/.claude/skills/",
        "Manifest version updated to 2",
        "Manifest stores full paths like ralph/prd",
        "Old flat-structure skills cleaned up during sync",
        "Typecheck passes",
        "Unit tests for nested sync"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Update ralph sync --remove for nested structure",
      "description": "As a user, I want ralph sync --remove to handle nested skill directories so that skills can be properly uninstalled",
      "acceptanceCriteria": [
        "Remove command removes nested directories correctly",
        "Handles both old flat and new nested structures",
        "Typecheck passes",
        "Unit tests for nested removal"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Add default reviewer configuration",
      "description": "As a user, I want sensible default reviewers when no configuration exists so that review loop works out of the box",
      "acceptanceCriteria": [
        "Default configuration includes all reviewers from spec",
        "test-quality, code-simplifier, python-code as blocking",
        "github-actions, repo-structure as warning",
        "release as blocking",
        "python-code filtered to python language",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Update CLAUDE.md with reviewer configuration example",
      "description": "As a user, I want CLAUDE.md to document reviewer configuration so that I can customize the review pipeline",
      "acceptanceCriteria": [
        "Add RALPH:REVIEWERS markers with default configuration",
        "Document configuration format in comments or README",
        "Consistent with existing checks documentation pattern"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Integration tests for review loop",
      "description": "As a developer, I want integration tests for the review loop so that the feature is properly validated",
      "acceptanceCriteria": [
        "Test review loop runs after stories complete",
        "Test --skip-review bypasses review loop",
        "Test --strict enforces warning reviewers",
        "Test language filtering works correctly",
        "All tests pass"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    }
  ]
}
