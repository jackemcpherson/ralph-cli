{
  "project": "RalphReview",
  "branchName": "ralph/review-command",
  "description": "Standalone ralph review command with automatic reviewer detection and configuration",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add Bicep language detection support",
      "description": "As a developer, I need the language detection service to recognize Bicep files so that the appropriate reviewer can be automatically configured.",
      "acceptanceCriteria": [
        "Add 'bicep' to the Language enum in src/ralph/services/language.py",
        "Add '*.bicep' file pattern detection using glob-based detection (not marker files)",
        "detect_languages() returns Language.bicep when .bicep files exist in project",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Added bicep to Language enum and introduced _LANGUAGE_PATTERNS dict for glob-based detection. Detection works for both root and subdirectory .bicep files."
    },
    {
      "id": "US-002",
      "title": "Create ReviewerDetector service for project analysis",
      "description": "As a developer, I need a service that analyzes project characteristics and determines which reviewers should be configured.",
      "acceptanceCriteria": [
        "Create src/ralph/services/reviewer_detector.py with ReviewerDetector class",
        "Implement detect_reviewers() method returning list of ReviewerConfig",
        "Detect Python projects (*.py files) → python-code reviewer",
        "Detect Bicep projects (*.bicep files) → bicep reviewer",
        "Detect GitHub Actions (.github/workflows/*.yml) → github-actions reviewer",
        "Detect test files (test_*.py, *_test.py) → test-quality reviewer",
        "Always include universal reviewers: code-simplifier, repo-structure",
        "Include release reviewer if CHANGELOG.md exists",
        "Export from services/__init__.py",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Created ReviewerDetector class with detect_reviewers() method. Detects Python, Bicep, GitHub Actions, test files, and CHANGELOG.md. Always includes code-simplifier and repo-structure as universal reviewers."
    },
    {
      "id": "US-003",
      "title": "Create ReviewerConfigWriter service for CLAUDE.md manipulation",
      "description": "As a developer, I need a service that can read and write the RALPH:REVIEWERS section in CLAUDE.md files.",
      "acceptanceCriteria": [
        "Create src/ralph/services/reviewer_config_writer.py with ReviewerConfigWriter class",
        "Implement has_reviewer_config(path) method to check if markers exist",
        "Implement write_reviewer_config(path, reviewers) method to write/update config",
        "Preserve all CLAUDE.md content outside the RALPH:REVIEWERS markers",
        "If markers don't exist, append section before '## Project-Specific Instructions' or at end",
        "Export from services/__init__.py",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Created ReviewerConfigWriter class with has_reviewer_config() and write_reviewer_config() methods. Preserves content outside markers, inserts before '## Project-Specific Instructions' when markers don't exist."
    },
    {
      "id": "US-004",
      "title": "Implement ralph review command with first-run behavior",
      "description": "As a developer, I want to run ralph review to automatically configure reviewers and execute the review loop on first run.",
      "acceptanceCriteria": [
        "Create src/ralph/commands/review.py with review command function",
        "Support --verbose flag consistent with other commands",
        "Support --strict flag to pass through to review loop",
        "On first run (no existing config): detect reviewers, write CLAUDE.md config, execute review loop",
        "Display which reviewers were configured and why (e.g., 'Added python-code reviewer (found .py files)')",
        "Register command in cli.py and export from commands/__init__.py",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Created review command with --verbose and --strict flags. On first run, detects reviewers using ReviewerDetector, displays detection reasons (e.g., 'found .py files'), writes config to CLAUDE.md, then executes review loop."
    },
    {
      "id": "US-005",
      "title": "Implement subsequent-run behavior with suggestions",
      "description": "As a developer, I want ralph review to detect missing reviewers on subsequent runs and suggest updating the configuration.",
      "acceptanceCriteria": [
        "On subsequent runs (config exists): execute review loop using existing config",
        "Detect if there are suggested reviewers not in current config",
        "Display warning listing suggested reviewers that could be added",
        "Suggest running 'ralph review --force' to update configuration",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "On subsequent runs, compares current config with detected reviewers using set difference. Displays missing reviewers with detection reasons and suggests --force flag."
    },
    {
      "id": "US-006",
      "title": "Implement --force flag behavior",
      "description": "As a developer, I want to run ralph review --force to re-detect and update my reviewer configuration when my project evolves.",
      "acceptanceCriteria": [
        "Support --force flag on review command",
        "Re-run full project detection when --force is provided",
        "Overwrite existing RALPH:REVIEWERS section with newly detected config",
        "Display what changed (added/removed reviewers) before executing review loop",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Implemented --force flag on review command. Re-runs full detection, compares old vs new config, displays added/removed reviewers, overwrites RALPH:REVIEWERS section. Tests cover all force flag scenarios including added, removed, both, no-changes, and first-run fallback."
    },
    {
      "id": "US-007",
      "title": "Add unit tests for reviewer detection",
      "description": "As a developer, I need tests to verify the reviewer detection logic works correctly for different project configurations.",
      "acceptanceCriteria": [
        "Create tests/test_reviewer_detector.py",
        "Test Python project detection returns python-code reviewer",
        "Test Bicep project detection returns bicep reviewer",
        "Test GitHub Actions detection returns github-actions reviewer",
        "Test universal reviewers always included",
        "Test CHANGELOG.md presence triggers release reviewer",
        "Tests pass"
      ],
      "priority": 7,
      "passes": true,
      "notes": "tests/test_reviewer_detector.py already existed from US-002 with 17 comprehensive tests covering all acceptance criteria. All tests pass. No additional code changes needed."
    },
    {
      "id": "US-008",
      "title": "Add unit tests for CLAUDE.md manipulation",
      "description": "As a developer, I need tests to verify the CLAUDE.md reviewer config writing preserves existing content correctly.",
      "acceptanceCriteria": [
        "Create tests/test_reviewer_config_writer.py",
        "Test writing config when markers don't exist appends section correctly",
        "Test writing config when markers exist replaces content between markers",
        "Test content outside markers is preserved",
        "Test insertion before '## Project-Specific Instructions' when present",
        "Tests pass"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Created tests/test_reviewer_config_writer.py with 15 tests covering has_reviewer_config, write with/without markers, content preservation, Project-Specific Instructions insertion, and convenience functions."
    },
    {
      "id": "US-009",
      "title": "Add integration tests for ralph review command",
      "description": "As a developer, I need integration tests to verify the ralph review command works end-to-end.",
      "acceptanceCriteria": [
        "Create tests/test_review_command.py",
        "Test first-run behavior creates CLAUDE.md config",
        "Test subsequent-run behavior uses existing config",
        "Test --force flag updates existing config",
        "Test --strict flag is passed through to review loop",
        "Tests pass"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    }
  ]
}
