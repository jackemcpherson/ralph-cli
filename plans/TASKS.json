{
  "project": "ralph-cli-v1.1-fixes",
  "branchName": "ralph/v1.1-bug-fixes",
  "description": "Bug fixes and automation improvements for Ralph CLI v1.1 - enables autonomous iteration and PRD automation",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add skip_permissions parameter to ClaudeService",
      "description": "As a developer, I want the ClaudeService.run_print_mode() method to support a skip_permissions parameter so that autonomous commands can run without permission prompts",
      "acceptanceCriteria": [
        "ClaudeService.run_print_mode() accepts skip_permissions: bool = False parameter",
        "When skip_permissions=True, '--dangerously-skip-permissions' is included in Claude CLI args",
        "When skip_permissions=False, the flag is not included",
        "Typecheck passes",
        "Unit tests verify both parameter states"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Foundation for FR-FIX-01. Modify src/ralph/services/claude.py around line 186"
    },
    {
      "id": "US-002",
      "title": "Enable skip_permissions in ralph once command",
      "description": "As a developer, I want ralph once to run Claude with skip_permissions=True by default so that autonomous iteration works without human intervention",
      "acceptanceCriteria": [
        "ralph once calls run_print_mode() with skip_permissions=True",
        "One-time info message displayed: 'Running Claude with auto-approved permissions for autonomous iteration'",
        "Typecheck passes",
        "Tests verify the command passes skip_permissions=True to ClaudeService"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Depends on US-001. Modify src/ralph/commands/once.py"
    },
    {
      "id": "US-003",
      "title": "Enable skip_permissions in ralph loop command",
      "description": "As a developer, I want ralph loop to run Claude with skip_permissions=True by default so that autonomous iteration works without human intervention",
      "acceptanceCriteria": [
        "ralph loop calls run_print_mode() with skip_permissions=True for each iteration",
        "One-time info message displayed at start of loop",
        "Typecheck passes",
        "Tests verify the command passes skip_permissions=True to ClaudeService"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Depends on US-001. Modify src/ralph/commands/loop.py"
    },
    {
      "id": "US-004",
      "title": "Add --input flag to ralph prd command",
      "description": "As a developer, I want to pass a feature description directly via --input flag so that I can automate PRD creation without interactive input",
      "acceptanceCriteria": [
        "ralph prd accepts --input / -i option with a string value",
        "When --input is provided, command runs in non-interactive mode with single prompt",
        "Feature description is passed to Claude for PRD generation",
        "Typecheck passes",
        "Tests verify --input triggers non-interactive mode"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Part of FR-FIX-02. Modify src/ralph/commands/prd.py and src/ralph/cli.py"
    },
    {
      "id": "US-005",
      "title": "Add --file flag to ralph prd command",
      "description": "As a developer, I want to pass a file path via --file flag so that I can provide longer feature descriptions from a file",
      "acceptanceCriteria": [
        "ralph prd accepts --file / -f option with a file path",
        "File contents are read and used as the feature description",
        "When --file is provided, command runs in non-interactive mode",
        "Error displayed if file does not exist",
        "Typecheck passes",
        "Tests verify --file reads file and triggers non-interactive mode"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Part of FR-FIX-02. Modify src/ralph/commands/prd.py and src/ralph/cli.py"
    },
    {
      "id": "US-006",
      "title": "Make --input and --file mutually exclusive",
      "description": "As a developer, I want clear error feedback if I accidentally provide both --input and --file flags",
      "acceptanceCriteria": [
        "Error displayed if both --input and --file are provided",
        "Error message is clear and actionable",
        "Command exits with non-zero code when both flags provided",
        "Typecheck passes",
        "Tests verify mutual exclusivity enforcement"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Part of FR-FIX-02. Modify src/ralph/commands/prd.py"
    },
    {
      "id": "US-007",
      "title": "Add file modification detection to ralph prd",
      "description": "As a developer, I want ralph prd to detect whether the SPEC.md file was actually modified so that I receive accurate feedback about the session outcome",
      "acceptanceCriteria": [
        "Before Claude runs, mtime of plans/SPEC.md is recorded (if file exists)",
        "After Claude completes, file mtime/existence is checked",
        "If file created/modified: success message displayed",
        "If file NOT modified: warning message displayed in yellow",
        "Command exits with code 0 in both cases",
        "Typecheck passes",
        "Tests verify detection logic for both scenarios"
      ],
      "priority": 7,
      "passes": true,
      "notes": "FR-FIX-03. Modify src/ralph/commands/prd.py"
    },
    {
      "id": "US-008",
      "title": "Integration tests for autonomous iteration",
      "description": "As a developer, I want integration tests that verify ralph once and ralph loop can run autonomously so that we can catch regressions",
      "acceptanceCriteria": [
        "Integration test for ralph once with skip_permissions behavior",
        "Integration test for ralph loop with skip_permissions behavior",
        "Tests mock Claude subprocess appropriately",
        "All tests pass",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": "Validates US-002 and US-003 work end-to-end"
    },
    {
      "id": "US-009",
      "title": "Integration tests for ralph prd automation",
      "description": "As a developer, I want integration tests that verify ralph prd --input and --file work correctly so that automation workflows are reliable",
      "acceptanceCriteria": [
        "Integration test for ralph prd --input",
        "Integration test for ralph prd --file",
        "Integration test for mutual exclusivity error",
        "Tests mock Claude subprocess and file operations appropriately",
        "All tests pass",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": "Validates US-004, US-005, and US-006 work end-to-end"
    }
  ]
}
